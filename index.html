<html>
  <head>
    <title>3D Gardener</title>
  </head>

  <style>
  body {margin: 0;}
  canvas {width: 100%; height: 100%;}
  </style>

  <body>
	<link rel="shortcut icon" href="#">

   
    <style>
    			body {
    				font-family: Monospace;
    				background-color: #000;
    				color: #fff;
    				margin: 0px;
    				overflow: hidden;
    			}
    			#info {
    				position: absolute;
    				top: 10px;
    				width: 100%;
    				text-align: center;
    			}
    </style>

    <div id="info">
      <p>3D Gardener</p>
    </div>

		<script type="importmap">
			{
				"imports": {
					"three": "./three.module.js"
				}
			}
		</script>
		
	<script type="module">

  import * as THREE from 'three';
  import * as WEATHER from './Weather.js';
	import { OrbitControls } from './build/controls/OrbitControls.js';
  import { GUI } from './build/gui/lil-gui.module.min.js';
  import { OBJLoader } from './build/loaders/OBJLoader.js'

    let scene, camera, renderer, controls, directionalLight, rain, 
    posAttr, cube, sun, sunOn = false, rainOn = false;

    const cubeColour = {
      hex: "#00FFFF"
    }

    function init() {

      scene = new THREE.Scene( );
      var ratio = window.innerWidth/window.innerHeight;
      camera = new THREE.PerspectiveCamera(45,ratio,0.1,1000);
      var sunOn = false;

      camera.position.set(0,3,30);
      camera.lookAt(0,0,1);

      var cameraLight = new THREE.PointLight(new THREE.Color(1,1,1), 0.8);
      camera.add(cameraLight);
      // scene.add(camera);

      directionalLight = new THREE.DirectionalLight(0xffeedd);
      directionalLight.position.set(0,0,1);
      // scene.add(directionalLight)

      renderer = new THREE.WebGLRenderer( );
      renderer.setSize(window.innerWidth,window.innerHeight);
      document.body.appendChild(renderer.domElement );
      controls = new OrbitControls( camera, renderer.domElement );

      rain = WEATHER.createRain();
      posAttr = WEATHER.getPositionAttributes();
      scene.add(rain);

      const cube_geo = new THREE.BoxGeometry(50,1,50);
      const cube_mat = new THREE.MeshLambertMaterial();
      cube_mat.color = new THREE.Color(cubeColour.hex);
      cube_mat.wireframe = false;
      cube = new THREE.Mesh(cube_geo, cube_mat);
      scene.add(cube);

      let light = new THREE.AmbientLight(0xffffff);
      light.intensity = .5;
      light.position.set(0, 0, 10);
      scene.add(light);

      var defaultSun = new THREE.PointLight(new THREE.Color(0xffffff), 1);
      defaultSun.position.y=300;
      defaultSun.position.x=300;
      defaultSun.position.z=300;
      defaultSun.intensity = 1;
      //scene.add(defaultSun);

      // var extremeSun = new THREE.SpotLight(new THREE.Color(0xf9d71c), 1);
      // var extremeSun = new THREE.SpotLight(new THREE.Color(0xf9d71c), 10);
      // extremeSun.position.y=300;
      // extremeSun.position.x=300;
      // extremeSun.position.z=300;
      // extremeSun.power = 10;
      
      sun = WEATHER.createSun();
      scene.add(sun);
      scene.add(sun.target);

      animate();

    }

    function sunColourChange(on) {
      if(on) {
        cube.material.color = new THREE.Color(0xfc6c8d);
      }
      else {
        cube.material.color = new THREE.Color(0xFF00FF);
      }
    }

    function animate() {
      sun.visible = sunOn;
      // sunColourChange(sunOn);
      rain.visible = rainOn;
      posAttr = WEATHER.animateRain();
      posAttr.needsUpdate = true;
      renderer.render(scene,camera);
      controls.update();
      requestAnimationFrame(animate);

    }
    init();

  var MyResize = function ( )
  {
    var width = window.innerWidth;
    var height = window.innerHeight;
    renderer.setSize(width,height);
    camera.aspect = width/height;
    camera.updateProjectionMatrix();
    renderer.render(scene,camera);
  };

    window.addEventListener( 'resize', MyResize);

    const gui = new GUI();
    const weather = {
        RainVar: false,
        SunVar: false,
    };

    gui.add(weather, 'RainVar').name('Rain').onChange(value => {rainOn = value});
    gui.add(weather, 'SunVar', 0, 1).name('Sun').onChange(value => {sunOn = value});
    //gui.addColor(cubeColour, 'hex').name("Colour").onChange(value => cube_mat.color.value = new THREE.Color(value));

      
    </script>
  </body>
</html>
